<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Access Gate</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:system-ui;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{
  width:260px;
  text-align:center;
}
input,button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
}
input{
  background:#111;
  color:#fff;
  text-align:center;
  letter-spacing:6px;
  margin-bottom:12px;
}
button{
  background:#2f80ed;
  color:#fff;
}
.msg{
  margin-top:10px;
  font-size:14px;
}
</style>
</head>

<body>

<div class="box">
  <input id="code" type="tel" inputmode="numeric" maxlength="4" placeholder="••••">
  <button onclick="unlock()">ENTER</button>
  <div class="msg" id="msg"></div>
</div>

<script>
// ===============================
// SENARAI HASH SAH (SHA-256 4 digit)
// ===============================
const VALID_HASHES = [
  // 1234
  "03ac674216f3e15c761ee1a5e255f067953623c8b388b4459e13f978d7c846f4",
  // 5678
  "f8638b979b2f4f793ddb6dbd197e0ee25a7a6ea32b79a93f6f6e3fbb9c7b8c1d",
  // 9999
  "888df25ae35772424a560c7152a1de794440e0ea5cfee62828333a456a506e05"
];

// AUTO LOGIN JIKA PERNAH LULUS
if (localStorage.getItem("permanent_access") === "yes") {
  location.replace("chat.html");
}

async function unlock(){
  const input = document.getElementById("code");
  const msg = document.getElementById("msg");
  const val = input.value.trim();

  if(val.length !== 4){
    msg.textContent = "Masukkan 4 digit";
    return;
  }

  const hash = await sha256(val);

  if(!VALID_HASHES.includes(hash)){
    msg.textContent = "❌ Kod tidak sah";
    return;
  }

  let used = JSON.parse(localStorage.getItem("used_hashes") || "[]");
  if(used.includes(hash)){
    msg.textContent = "⚠️ Kod telah digunakan";
    return;
  }

  // tandakan digunakan
  used.push(hash);
  localStorage.setItem("used_hashes", JSON.stringify(used));

  // akses kekal
  localStorage.setItem("permanent_access","yes");

  msg.textContent = "✅ Akses diterima";
  setTimeout(()=>location.href="chat.html",700);
}

async function sha256(text){
  const buf = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(text)
  );
  return [...new Uint8Array(buf)]
    .map(b=>b.toString(16).padStart(2,"0"))
    .join("");
}
</script>

</body>
</html>